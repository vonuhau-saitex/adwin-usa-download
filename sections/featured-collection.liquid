{{ 'featured-collection.css' | asset_url | stylesheet_tag }}
{{ 'product-grid.css' | asset_url | stylesheet_tag }}
{%- liquid
  assign section_heading = section.settings.heading
  assign section_heading_left = section.settings.heading_left
  assign section_description = section.settings.description
  assign full_width = section.settings.full_width
  assign display_type = section.settings.display_type
  assign columns_desktop = section.settings.columns_desktop
  assign featured_collection = section.settings.collection
  assign show_view_all = section.settings.show_view_all
  assign product_limit = section.settings.product_limit
  assign mobile_swipe = section.settings.mobile_swipe
  assign show_progress_bar = section.settings.show_progress_bar
  assign disable_top_spacing = section.settings.disable_top_spacing
  assign disable_bottom_spacing = section.settings.disable_bottom_spacing
  assign columns_class = 'small-6 medium-6 large-4'
  case columns_desktop
    when 2
      assign columns_class = 'small-6 medium-6'
    when 3
      assign columns_class = 'small-6 medium-4'
    when 4
      assign columns_class = 'small-6 medium-6 large-3'
  endcase

  if featured_collection.all_products_count > product_limit
    assign more_in_collection = true
  endif

  if show_view_all and more_in_collection
    assign section_heading_button = featured_collection
  endif
-%}
<div class="featured-collection{% if mobile_swipe %} swipe-on-mobile{% endif %} section-spacing{% if disable_top_spacing %} section-spacing--disable-top{% endif %}{% if disable_bottom_spacing %} section-spacing--disable-bottom{% endif %}">
  <div class="row{% if full_width %} full-width-row{% endif %}">
    <div class="small-12 columns">
      {% render 'section-header',
        section_heading: section_heading,
        section_description: section_description,
        section_heading_left: section_heading_left,
        section_heading_button: section_heading_button
      %}
      <div class="featured-collection__inner display-type--{{ display_type }}">
        <div id="product-grid-{{ section.id }}" class="products row {{ display_type }}">
          {%- if featured_collection != blank -%}
            {%- for product in featured_collection.products limit: product_limit -%}
              <div class="{{ columns_class }} columns {% if display_type == 'carousel' %}carousel__slide{% endif %}">
                {% render 'product-card', product_card_product: product %}
              </div>
            {%- endfor -%}
          {%- else -%}
            {%- for i in (1..product_limit) -%}
              <div class="{{ columns_class }} columns {% if display_type == 'carousel' %}carousel__slide{% endif %}">
                {% render 'product-card' %}
              </div>
            {%- endfor -%}
          {%- endif -%}
          {%- for block in section.blocks -%}
              <div class="{{ columns_class }} columns {% if display_type == 'carousel' %}carousel__slide{% endif %}" >
                {%- render 'product-promotion', block: block -%}
              </div>
          {%- endfor -%}
          {%- if display_type == 'carousel' -%}
            {%- if product_limit > columns_desktop -%}
              <div class="flickity-nav flickity-prev" tabindex="0">{% render 'svg-icons' with 'carousel-prev' %}</div>
              <div class="flickity-nav flickity-next" tabindex="0">{% render 'svg-icons' with 'carousel-next' %}</div>
            {%- endif -%}
          {%- endif -%}
        </div>
        {%- if display_type == 'carousel' and show_progress_bar -%}
          <div class="flickity-progress">
            <div class="flickity-progress--bar"></div>
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Featured collection",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Collection"
    },
		{
			"type": "checkbox",
			"id": "heading_left",
			"default": false,
			"label": "Left align heading"
		},
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Describe your featured collection here</p>"
    },
		{
			"type": "checkbox",
			"id": "full_width",
			"label": "Make section full width",
			"default": true
		},
		{
			"type": "header",
			"content": "Collection"
		},
		{
		 "type": "collection",
		 "id": "collection",
		 "label": "Collection"
		},
		{
			"type": "select",
			"id": "display_type",
			"options": [
				{
					"value": "grid",
					"label": "Grid"
				},
				{
					"value": "carousel",
					"label": "Carousel"
				}
			],
			"default": "grid",
			"label": "Display type"
		},
		{
			"type": "range",
			"id": "product_limit",
			"min": 2,
			"max": 12,
			"step": 1,
			"label": "Maximum products to show",
			"default": 4
		},
		{
			"type": "range",
			"id": "columns_desktop",
			"min": 2,
			"max": 4,
			"step": 1,
			"default": 4,
			"label": "Number of columns on desktop"
		},
		{
			"type": "checkbox",
			"id": "show_view_all",
			"default": true,
			"label": "Enable \"View all\" button if collection has more products than shown"
		},
		{
			"type": "header",
			"content": "Grid"
		},
		{
			"type": "checkbox",
			"id": "mobile_swipe",
			"default": true,
			"label": "Enable swipe on mobile"
		},
		{
			"type": "header",
			"content": "Carousel"
		},
		{
			"type": "checkbox",
			"id": "show_progress_bar",
			"label": "Show progress bar",
			"default": true
		},
		{
      "type": "header",
      "content": "Spacing"
    },
		{
			"type": "checkbox",
			"id": "disable_top_spacing",
			"default": false,
			"label": "Remove top spacing"
		},
		{
			"type": "checkbox",
			"id": "disable_bottom_spacing",
			"default": false,
			"label": "Remove bottom spacing"
		}
  ],
  "blocks": [
      {
        "type": "promotion",
        "name": "Promotion",
        "settings": [
          {
            "type": "collection",
            "id": "promotion_collection",
            "label": "Collection",
						"info": "Show on specific collection only"
          },
					{
		        "type": "range",
		        "id": "promotion_position",
		        "min": 1,
		        "max": 24,
		        "step": 1,
		        "label": "Show in position",
		        "default": 1
		      },
					{
			      "type": "select",
			      "id": "promotion_width",
			      "options": [
			        {
			          "value": "1",
			          "label": "1 column"
			        },
			        {
			          "value": "2",
			          "label": "2 columns"
			        }
			      ],
			      "default": "1",
			      "label": "Width"
			    },
					{
            "type": "image_picker",
            "id": "image",
            "label": "Image"
          },
					{
						"type": "text",
						"id": "title",
						"default": "Promotion",
						"label": "Heading"
					},
					{
						"type": "textarea",
						"id": "text",
						"default": "Advertise a promotion or a sale",
						"label": "Description"
					},
					{
            "id": "link_label",
            "type": "text",
            "label": "Button label",
            "default": "Explore",
						"info": "Leave the label blank to hide the button."
          },
          {
            "id": "link",
            "type": "url",
            "label": "Button link"
          },
					{
						 "type": "checkbox",
						 "id": "use_text_button",
						 "label": "Use text button",
						 "default": false
					},
					{
            "id": "block_link",
            "type": "url",
            "label": "Link",
						"info": "This will allow you to set a link to the promotion"
          },
					{
			      "type": "header",
			      "content": "Colors"
			    },
					{
						"type": "color",
						"id": "overlay_color",
						"label": "Overlay",
						"default": "#000000"
					},
					{
						"type": "range",
						"id": "overlay_opacity",
						"min": 0,
						"max": 100,
						"step": 1,
						"unit": "%",
						"label": "Overlay opacity",
						"default": 70
					}
				]
			}],
  "presets": [
    {
      "name": "Featured collection"
    }
  ]
}
{% endschema %}
