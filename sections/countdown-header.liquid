{{ 'countdown-header.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign enable_countdown = section.settings.enable_countdown
  assign header_text = section.settings.header_text
  assign button_text = section.settings.button_text
  assign button_link = section.settings.button_link
  assign text_alignment = section.settings.text_alignment

  assign color_bg = section.settings.color_bg
  assign color_text = section.settings.color_text
  assign color_button_bg = section.settings.color_button_bg
  assign color_button_text = section.settings.color_button_text

  assign timer_year = section.settings.timer_year
  assign timer_month = section.settings.timer_month
  assign timer_day = section.settings.timer_day
  assign timer_hour = section.settings.timer_hour
  assign timer_minute = section.settings.timer_minute

  assign show_days = section.settings.show_days
  assign show_hours = section.settings.show_hours
  assign show_minutes = section.settings.show_minutes
  assign show_seconds = section.settings.show_seconds

  assign days_label = section.settings.days_label
  assign hours_label = section.settings.hours_label
  assign minutes_label = section.settings.minutes_label
  assign seconds_label = section.settings.seconds_label

  assign timezone = 1 | date: '%z'

  capture date
    echo timer_day | append: '-' | append: timer_month | append: '-' | append: timer_year
  endcapture

  capture time
    echo timer_hour | append: ':' | append: timer_minute
  endcapture
-%}

{%- if enable_countdown -%}
<div 
  class="countdown-header sticky-countdown" 
  style="--countdown-bg: {{ color_bg }}; --countdown-text: {{ color_text }}; --countdown-button-bg: {{ color_button_bg }}; --countdown-button-text: {{ color_button_text }};"
>
  <div class="countdown-header__container">
    {%- if section.settings.show_close_button -%}
      <button class="countdown-header__close" aria-label="Close countdown banner">&times;</button>
    {%- endif -%}
    <div class="countdown-header__content text-{{ text_alignment }}">
      {%- if header_text != blank -%}
        <span class="countdown-header__text">{{ header_text }}</span>
      {%- endif -%}
      
      <countdown-header-timer class="countdown-header__timer" data-date="{{ date }}" data-time="{{ time }}" data-timezone="{{ timezone }}">
        {%- if show_days -%}
          <div class="countdown-timer__column days">
            <span class="countdown-timer__number">00</span>
            <span class="countdown-timer__label">{{ days_label | default: 'Days' }}</span>
          </div>
        {%- endif -%}
        {%- if show_hours -%}
          <div class="countdown-timer__column hours">
            <span class="countdown-timer__number">00</span>
            <span class="countdown-timer__label">{{ hours_label | default: 'Hours' }}</span>
          </div>
        {%- endif -%}
        {%- if show_minutes -%}
          <div class="countdown-timer__column minutes">
            <span class="countdown-timer__number">00</span>
            <span class="countdown-timer__label">{{ minutes_label | default: 'Minutes' }}</span>
          </div>
        {%- endif -%}
        {%- if show_seconds -%}
          <div class="countdown-timer__column seconds">
            <span class="countdown-timer__number">00</span>
            <span class="countdown-timer__label">{{ seconds_label | default: 'Seconds' }}</span>
          </div>
        {%- endif -%}
      </countdown-header-timer>

      {%- if button_text != blank and button_link != blank -%}
        <a class="countdown-header__button" href="{{ button_link }}" title="{{ button_text | escape }}">
          {{ button_text }}
        </a>
      {%- endif -%}
    </div>
  </div>
</div>
<script src="{{ 'countdown-header.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

{% schema %}
{
  "name": "Countdown Header",
  "class": "section-countdown-header",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_countdown",
      "label": "Enable countdown header",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_close_button",
      "label": "Show close button",
      "default": true,
      "info": "Allow users to dismiss the countdown header"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "header_text",
      "label": "Header text",
      "default": "Sale ends in:",
      "info": "Text to display before the countdown timer"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Shop now",
      "info": "Leave blank to hide button"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Timer Settings"
    },
    {
      "type": "number",
      "id": "timer_year",
      "label": "Year",
      "default": 2025
    },
    {
      "type": "select",
      "id": "timer_month",
      "label": "Month",
      "options": [
        {"value": "01", "label": "January"},
        {"value": "02", "label": "February"},
        {"value": "03", "label": "March"},
        {"value": "04", "label": "April"},
        {"value": "05", "label": "May"},
        {"value": "06", "label": "June"},
        {"value": "07", "label": "July"},
        {"value": "08", "label": "August"},
        {"value": "09", "label": "September"},
        {"value": "10", "label": "October"},
        {"value": "11", "label": "November"},
        {"value": "12", "label": "December"}
      ],
      "default": "12"
    },
    {
      "type": "select",
      "id": "timer_day",
      "label": "Day",
      "options": [
        {"value": "01", "label": "01"}, {"value": "02", "label": "02"}, {"value": "03", "label": "03"}, {"value": "04", "label": "04"}, {"value": "05", "label": "05"},
        {"value": "06", "label": "06"}, {"value": "07", "label": "07"}, {"value": "08", "label": "08"}, {"value": "09", "label": "09"}, {"value": "10", "label": "10"},
        {"value": "11", "label": "11"}, {"value": "12", "label": "12"}, {"value": "13", "label": "13"}, {"value": "14", "label": "14"}, {"value": "15", "label": "15"},
        {"value": "16", "label": "16"}, {"value": "17", "label": "17"}, {"value": "18", "label": "18"}, {"value": "19", "label": "19"}, {"value": "20", "label": "20"},
        {"value": "21", "label": "21"}, {"value": "22", "label": "22"}, {"value": "23", "label": "23"}, {"value": "24", "label": "24"}, {"value": "25", "label": "25"},
        {"value": "26", "label": "26"}, {"value": "27", "label": "27"}, {"value": "28", "label": "28"}, {"value": "29", "label": "29"}, {"value": "30", "label": "30"}, {"value": "31", "label": "31"}
      ],
      "default": "31"
    },
    {
      "type": "select",
      "id": "timer_hour",
      "label": "Hour",
      "options": [
        {"value": "00", "label": "12 AM (Midnight)"}, {"value": "01", "label": "01 AM"}, {"value": "02", "label": "02 AM"}, {"value": "03", "label": "03 AM"},
        {"value": "04", "label": "04 AM"}, {"value": "05", "label": "05 AM"}, {"value": "06", "label": "06 AM"}, {"value": "07", "label": "07 AM"},
        {"value": "08", "label": "08 AM"}, {"value": "09", "label": "09 AM"}, {"value": "10", "label": "10 AM"}, {"value": "11", "label": "11 AM"},
        {"value": "12", "label": "12 PM (Noon)"}, {"value": "13", "label": "01 PM"}, {"value": "14", "label": "02 PM"}, {"value": "15", "label": "03 PM"},
        {"value": "16", "label": "04 PM"}, {"value": "17", "label": "05 PM"}, {"value": "18", "label": "06 PM"}, {"value": "19", "label": "07 PM"},
        {"value": "20", "label": "08 PM"}, {"value": "21", "label": "09 PM"}, {"value": "22", "label": "10 PM"}, {"value": "23", "label": "11 PM"}
      ],
      "default": "23"
    },
    {
      "type": "select",
      "id": "timer_minute",
      "label": "Minute",
      "options": [
        {"value": "00", "label": "00"}, {"value": "15", "label": "15"}, {"value": "30", "label": "30"}, {"value": "45", "label": "45"}, {"value": "59", "label": "59"}
      ],
      "default": "59"
    },
    {
      "type": "header",
      "content": "Display Options"
    },
    {
      "type": "checkbox",
      "id": "show_days",
      "label": "Show days",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_hours",
      "label": "Show hours",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_minutes",
      "label": "Show minutes",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_seconds",
      "label": "Show seconds",
      "default": true
    },
    {
      "type": "header",
      "content": "Custom Labels"
    },
    {
      "type": "text",
      "id": "days_label",
      "label": "Days label",
      "default": "Days"
    },
    {
      "type": "text",
      "id": "hours_label",
      "label": "Hours label",
      "default": "Hours"
    },
    {
      "type": "text",
      "id": "minutes_label",
      "label": "Minutes label",
      "default": "Minutes"
    },
    {
      "type": "text",
      "id": "seconds_label",
      "label": "Seconds label",
      "default": "Seconds"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "color_bg",
      "label": "Background color",
      "default": "#ff6b6b"
    },
    {
      "type": "color",
      "id": "color_text",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "color_button_bg",
      "label": "Button background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "color_button_text",
      "label": "Button text color",
      "default": "#ff6b6b"
    }
  ],
  "presets": [
    {
      "name": "Countdown Header"
    }
  ]
}
{% endschema %}
