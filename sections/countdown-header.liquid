{%- liquid
  assign countdown_enabled = section.settings.countdown_enabled
  assign countdown_bg_color = section.settings.countdown_bg_color
  assign countdown_text_color = section.settings.countdown_text_color
  assign countdown_timer_year = section.settings.countdown_timer_year
  assign countdown_timer_month = section.settings.countdown_timer_month
  assign countdown_timer_day = section.settings.countdown_timer_day
  assign countdown_timer_hour = section.settings.countdown_timer_hour
  assign countdown_timer_minute = section.settings.countdown_timer_minute
  assign countdown_message = section.settings.countdown_message
  assign countdown_button_text = section.settings.countdown_button_text
  assign countdown_button_link = section.settings.countdown_button_link
  assign countdown_button_bg_color = section.settings.countdown_button_bg_color
  assign countdown_button_text_color = section.settings.countdown_button_text_color

  assign timezone = 1 | date: '%z'

  capture countdown_date
    echo countdown_timer_day | append: '-' | append: countdown_timer_month | append: '-' | append: countdown_timer_year
  endcapture

  capture countdown_time
    echo countdown_timer_hour | append: ':' | append: countdown_timer_minute
  endcapture
-%}

{% if countdown_enabled %}
{{ 'countdown-header.css' | asset_url | stylesheet_tag }}
<script src="{{ 'countdown-header.js' | asset_url }}" defer></script>

<div class="countdown-header-standalone" style="background-color: {{ countdown_bg_color }}; color: {{ countdown_text_color }};">
  <div class="countdown-header-content">
    {% if countdown_message != blank %}
      <div class="countdown-message">{{ countdown_message }}</div>
    {% endif %}
    
    <countdown-timer 
      class="countdown-timer-header"
      data-date="{{ countdown_date }}"
      data-time="{{ countdown_time }}"
      data-timezone="{{ timezone }}">
      <div class="countdown-timer-display">
        <div class="countdown-item">
          <span class="countdown-number days">
            <span class="countdown-timer--column--number">00</span>
          </span>
          <span class="countdown-label">Days</span>
        </div>
        <div class="countdown-separator">:</div>
        <div class="countdown-item">
          <span class="countdown-number hours">
            <span class="countdown-timer--column--number">00</span>
          </span>
          <span class="countdown-label">Hours</span>
        </div>
        <div class="countdown-separator">:</div>
        <div class="countdown-item">
          <span class="countdown-number minutes">
            <span class="countdown-timer--column--number">00</span>
          </span>
          <span class="countdown-label">Minutes</span>
        </div>
        <div class="countdown-separator">:</div>
        <div class="countdown-item">
          <span class="countdown-number seconds">
            <span class="countdown-timer--column--number">00</span>
          </span>
          <span class="countdown-label">Seconds</span>
        </div>
      </div>
    </countdown-timer>
    
    {% if countdown_button_text != blank and countdown_button_link != blank %}
      <a href="{{ countdown_button_link }}" class="countdown-button" style="background-color: {{ countdown_button_bg_color }}; color: {{ countdown_button_text_color }};">
        {{ countdown_button_text }}
      </a>
    {% endif %}
  </div>
</div>
{% endif %}

{% schema %}
{
  "name": "Countdown Header",
  "class": "countdown-header-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "countdown_enabled",
      "label": "Enable countdown header",
      "default": true,
      "info": "Display a fixed countdown header at the top of the page"
    },
    {
      "type": "text",
      "id": "countdown_message",
      "label": "Countdown message",
      "default": "Time is ticking",
      "info": "Message displayed before the countdown timer"
    },
    {
      "type": "header",
      "content": "Countdown Timer"
    },
    {
      "type": "range",
      "id": "countdown_timer_day",
      "min": 1,
      "max": 31,
      "step": 1,
      "label": "Day",
      "default": 31
    },
    {
      "type": "range",
      "id": "countdown_timer_month",
      "min": 1,
      "max": 12,
      "step": 1,
      "label": "Month",
      "default": 12
    },
    {
      "type": "range",
      "id": "countdown_timer_year",
      "min": 2024,
      "max": 2030,
      "step": 1,
      "label": "Year",
      "default": 2025
    },
    {
      "type": "range",
      "id": "countdown_timer_hour",
      "min": 0,
      "max": 23,
      "step": 1,
      "label": "Hour (24h format)",
      "default": 23
    },
    {
      "type": "range",
      "id": "countdown_timer_minute",
      "min": 0,
      "max": 59,
      "step": 1,
      "label": "Minute",
      "default": 59
    },
    {
      "type": "header",
      "content": "Styling"
    },
    {
      "type": "color",
      "id": "countdown_bg_color",
      "label": "Background color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "countdown_text_color",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "text",
      "id": "countdown_button_text",
      "label": "Button text",
      "default": "Shop now"
    },
    {
      "type": "url",
      "id": "countdown_button_link",
      "label": "Button link"
    },
    {
      "type": "color",
      "id": "countdown_button_bg_color",
      "label": "Button background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "countdown_button_text_color",
      "label": "Button text color",
      "default": "#000000"
    }
  ],
  "presets": [
    {
      "name": "Countdown Header"
    }
  ]
}
{% endschema %}
